<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whispers of Morocco</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:opsz,wght@6..96,800&family=Inter:wght@300;400&display=swap" rel="stylesheet">
    <style>
        /* --- Base Styles & Variables --- */
        :root {
            /* Relaxing Pastel Palette */
            --color-bg-main: #f4f1de;
            --color-text-primary: #4a4e69;
            --color-text-on-dark: #f4f1de; /* For use on dark/gradient backgrounds like the detail view */
            --color-text-secondary: #7a6c78; /* Increased contrast for secondary text */
            --color-accent: #e5d9d7; /* Lightened for accessible button contrast */
            --color-accent-dark: #d4c3c1; /* Darker accent for hover states */

            /* Location-Specific Themes (Pastel Versions) */
            --theme-majorelle-bg: #8ecae6;
            --theme-majorelle-text: #219ebc;
            --theme-chefchaouen-bg: #a2d2ff;
            --theme-chefchaouen-text: #0077b6;
            --theme-sahara-bg: #ffb703;
            --theme-sahara-text: #fb8500;
            --theme-aitbenhaddou-bg: #e09f3e;
            --theme-aitbenhaddou-text: #9d4edd;

            /* Transition Speed and Easing */
            --transition-speed: 0.8s;
            --transition-ease: cubic-bezier(0.83, 0, 0.17, 1);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-main);
            color: var(--color-text-primary);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* --- App Container & Background Effects --- */

        /* --- Main App Container --- */
        #app-container {
            height: 100%;
            width: 100%;
            position: relative;
            perspective: 1200px;
        }

        /* --- Background Surface (The Tadelakt Wall) --- */
        .background-surface {
            position: absolute;
            inset: 0;
            z-index: 0;
            animation: gradient-animation 10s ease infinite;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Geometric Pattern Overlay --- */
        .pattern-overlay {
            position: absolute;
            inset: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M 0 50 L 50 0 L 100 50 L 50 100 Z" fill="none" stroke="%234a4e69" stroke-width="0.3" opacity="0.2"/></svg>');
            animation: pan 180s linear infinite;
            z-index: 1;
            opacity: 0.8;
            transition: opacity 0.8s ease;
        }
        
        #app-container.detail-view-active .pattern-overlay {
            opacity: 0;
        }

        @keyframes pan {
            0% { background-position: 0 0; }
            100% { background-position: 300px 300px; }
        }

        /* --- Universal Section Styling --- */
        .view {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 5vw;
            will-change: transform, opacity;
            transition: transform var(--transition-speed) var(--transition-ease), 
                        opacity var(--transition-speed) var(--transition-ease);
            z-index: 10;
        }

        /* --- Hero View (The Initial Welcome) --- */
        #hero-view {
            opacity: 1;
            transform: translateY(0);
        }

        #hero-view.hidden {
            opacity: 0;
            transform: translateY(-50px);
            pointer-events: none;
        }
        
        #hero-view h1 {
            font-family: 'Bodoni Moda', serif;
            font-size: clamp(3rem, 15vw, 10rem);
            font-weight: 900;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--color-text-primary);
            animation: fadeIn 2s var(--transition-ease) forwards;
            opacity: 0;
        }

        #hero-view p {
            font-size: clamp(1rem, 2.5vw, 1.5rem);
            letter-spacing: 0.25em;
            text-transform: uppercase;
            margin-top: 1.5rem;
            animation: fadeIn 2s var(--transition-ease) 0.5s forwards;
            opacity: 0;
        }

        .explore-button {
            margin-top: 3rem;
            background: var(--color-accent);
            border: none;
            border-radius: 50px;
            padding: 1rem 2.5rem;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            cursor: pointer;
            color: var(--color-text-primary);
            transition: all 0.4s ease;
            animation: fadeIn 2s var(--transition-ease) 1s forwards;
            opacity: 0;
        }

        .explore-button:hover, .explore-button:focus-visible {
            background: var(--color-accent-dark);
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            outline: none;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* --- Attractions View (The Impressions) --- */
        #attractions-view {
            opacity: 0;
            transform: translateY(50px);
            pointer-events: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            width: 100%;
            height: 100%;
        }

        #attractions-view.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .attraction-card {
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            transition: transform 0.4s var(--transition-ease);
            -webkit-tap-highlight-color: transparent;
            background: none;
            border: none;
            padding: 0;
            font-family: inherit;
        }
        
        .attraction-card:hover, .attraction-card:focus {
            transform: scale(1.02) translateY(-5px);
            outline: none;
        }

        .attraction-card:focus .shape {
            box-shadow: 0 0 0 4px var(--color-accent);
        }
        
        .attraction-card .shape {
            width: 200px;
            height: 300px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255,255,255,0.6);
            transition: all 0.4s var(--transition-ease);
        }
        
        .attraction-card:hover .shape, .attraction-card:focus-visible .shape {
            box-shadow: 0 25px 55px rgba(0, 0, 0, 0.2);
            transform: translateY(-5px);
            border-color: rgba(255,255,255,1);
        }



        .attraction-card h2 {
            position: absolute;
            font-family: 'Bodoni Moda', serif;
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--color-text-primary);
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            text-align: center;
            transition: all 0.4s var(--transition-ease);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            pointer-events: none; /* Allows clicks to pass through to the parent button */
        }

        .attraction-card:hover h2, .attraction-card:focus-visible h2 {
            transform: scale(1.1);
        }
        
        /* --- Detail View (The Full Immersion) --- */
        #detail-view {
            opacity: 0;
            transform: translateZ(-200px);
            pointer-events: none;
            text-align: left;
            align-items: flex-start;
            justify-content: flex-end;
            padding: 8vw;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0) 40%, rgba(0,0,0,0) 60%, rgba(0,0,0,0.7));
            z-index: 20;
        }
        
        #detail-view.visible {
            opacity: 1;
            transform: translateZ(0);
            pointer-events: auto;
        }

        #detail-view .content-wrapper {
            max-width: 600px;
            color: var(--color-text-primary);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 1.2s var(--transition-ease) 0.4s, 
                        opacity 1.2s var(--transition-ease) 0.4s;
        }

        #detail-view.visible .content-wrapper {
            transform: translateY(0);
            opacity: 1;
        }

        #detail-view h2 {
            font-family: 'Bodoni Moda', serif;
            font-size: clamp(3rem, 10vw, 8rem);
            font-weight: 900;
            line-height: 1.1;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            text-shadow: 0 5px 30px rgba(0,0,0,0.3);
        }
        
        #detail-view p {
            font-size: clamp(1.1rem, 1.8vw, 1.3rem);
            line-height: 1.9;
            margin-top: 2rem;
            font-weight: 400;
            text-shadow: 0 2px 15px rgba(0,0,0,0.5);
        }
        
        .close-button {
            position: absolute;
            top: 5vw;
            right: 5vw;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.2);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.4s ease;
            transform: scale(0);
            opacity: 0;
        }

        #detail-view.visible .close-button {
            transform: scale(1);
            opacity: 1;
            transition-delay: 0.8s;
        }

        /* FIX: Increased specificity to remove !important */
        .close-button:hover, .close-button:focus-visible {
            transform: scale(1.1) rotate(90deg);
            background: rgba(255,255,255,0.2);
            outline: none;
        }
        
        .close-button::before,
        .close-button::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 1px;
            background-color: var(--color-text-primary);
        }
        
        .close-button::before { transform: rotate(45deg); }
        .close-button::after { transform: rotate(-45deg); }

    </style>
</head>
<body>

    <div id="app-container">
        
        <div id="background" class="background-surface"></div>
        <div class="pattern-overlay"></div>

        <section id="hero-view" class="view">
            <h1>Morocco</h1>
            <p>Whispers on the Wind</p>
            <button class="explore-button">Explore</button>
        </section>

        <section id="attractions-view" class="view"></section>

        <section id="detail-view" class="view">
             <!-- FIX: Changed div to button for accessibility -->
            <button class="close-button" aria-label="Close details view"></button>
            <div class="content-wrapper">
                <h2 id="detail-title"></h2>
                <p id="detail-description"></p>
            </div>
        </section>

    </div>

    <script>
        const attractionsData = {
            majorelle: {
                title: "Jardin Majorelle",
                description: "A cobalt dream in the heart of Marrakech. Here, intense blue architecture stands in quiet rebellion against the greens of a thousand exotic plants. It is a sanctuary of color and calm.",
                gradient: "linear-gradient(145deg, var(--theme-majorelle-bg), var(--theme-majorelle-text))",
                clipPath: "polygon(0 0, 100% 20%, 100% 100%, 0 80%)",
            },
            chefchaouen: {
                title: "Chefchaouen",
                description: "The Blue Pearl, nestled in the Rif Mountains. Every wall, door, and pathway is washed in a symphony of blues, a city that feels like walking through a fragment of the sky.",
                gradient: "linear-gradient(145deg, var(--theme-chefchaouen-bg), var(--theme-chefchaouen-text))",
                clipPath: "circle(50% at 50% 50%)",
            },
            sahara: {
                title: "The Sahara",
                description: "An ocean of sand where dunes rise and fall like silent breaths. The world is reduced to light, shadow, and the profound silence of infinity. Time itself seems to pause here.",
                gradient: "linear-gradient(145deg, var(--theme-sahara-bg), var(--theme-sahara-text))",
                clipPath: "polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)",
            },
            aitbenhaddou: {
                title: "Aït Benhaddou",
                description: "A fortress city carved from the earth itself. The ancient pisé walls hold centuries of stories, glowing amber under the African sun. A testament to human ingenuity against the vast landscape.",
                gradient: "linear-gradient(145deg, var(--theme-aitbenhaddou-bg), var(--theme-aitbenhaddou-text))",
                clipPath: "polygon(0% 15%, 15% 15%, 15% 0%, 85% 0%, 85% 15%, 100% 15%, 100% 85%, 85% 85%, 85% 100%, 15% 100%, 15% 85%, 0% 85%)",
            },
            fes: {
                title: "Fes el-Bali",
                description: "The world's largest living medieval city. A labyrinth of 9,000 alleyways where the call to prayer echoes and the scent of spices and leather fills the air. A journey back in time.",
                gradient: "linear-gradient(145deg, #e0bfa0, #c9ada7)",
                clipPath: "polygon(0 0, 100% 0, 100% 100%, 0 100%)",
            },
            essaouira: {
                title: "Essaouira",
                description: "A windswept coastal town where the Atlantic meets ancient ramparts. Seagulls cry over the bustling fishing port and the air is fresh with the scent of the ocean.",
                gradient: "linear-gradient(145deg, #a2d2ff, #8ecae6)",
                clipPath: "polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%)",
            },
            dades: {
                title: "Dades Gorges",
                description: "A dramatic landscape of towering rock formations and winding roads. The 'Monkey Fingers' cliffs and the winding Tizi n'Tichka pass are a testament to nature's artistry.",
                gradient: "linear-gradient(145deg, #ffafcc, #ffc8dd)",
                clipPath: "polygon(0 0, 100% 0, 100% 75%, 50% 100%, 0 75%)",
            },
            merzouga: {
                title: "Merzouga",
                description: "Gateway to the Erg Chebbi dunes. Here, the Sahara's golden sands stretch as far as the eye can see, offering a spectacle of light and shadow at sunrise and sunset.",
                gradient: "linear-gradient(145deg, #ffca3a, #ffb703)",
                clipPath: "polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)",
            },
            casablanca: {
                title: "Casablanca",
                description: "Morocco's largest city, a bustling metropolis where modern life and tradition coexist. The magnificent Hassan II Mosque, standing over the Atlantic, is a sight to behold.",
                gradient: "linear-gradient(145deg, #bde0fe, #a2d2ff)",
                clipPath: "polygon(0 0, 100% 0, 100% 85%, 0 100%)",
            },
            rabat: {
                title: "Rabat",
                description: "The capital of Morocco, a city of lush parks and grand boulevards. The ancient Kasbah of the Udayas and the tranquil Chellah necropolis offer a glimpse into its rich history.",
                gradient: "linear-gradient(145deg, #c1fba4, #90ee90)",
                clipPath: "polygon(0 15%, 100% 0, 100% 85%, 0 100%)",
            },
            tangier: {
                title: "Tangier",
                description: "A city at the crossroads of Europe and Africa, a melting pot of cultures. The Caves of Hercules and the vibrant medina have inspired artists and writers for centuries.",
                gradient: "linear-gradient(145deg, #bde0fe, #8ecae6)",
                clipPath: "polygon(0 0, 85% 0, 100% 100%, 15% 100%)",
            },
            meknes: {
                title: "Meknes",
                description: "The 'Versailles of Morocco', an imperial city with a grand vision. The monumental Bab Mansour gate and the vast Heri es-Souani granaries are a testament to its glorious past.",
                gradient: "linear-gradient(145deg, #ffc8dd, #c9ada7)",
                clipPath: "polygon(25% 0%, 100% 0%, 75% 100%, 0% 100%)",
            },
        };

        // --- Architected State Management and Event Handling ---
        
        // DOM Elements
        const appContainer = document.getElementById('app-container');
        const background = document.getElementById('background');
        const heroView = document.getElementById('hero-view');
        const attractionsView = document.getElementById('attractions-view');
        const detailView = document.getElementById('detail-view');
        const exploreButton = document.querySelector('.explore-button');
        const attractionCards = document.querySelectorAll('.attraction-card');
        const closeButton = document.querySelector('.close-button');
        const detailTitle = document.getElementById('detail-title');
        const detailDescription = document.getElementById('detail-description');

        // State Machine
        let isTransitioning = false;
        const initialGradient = "linear-gradient(145deg, var(--color-bg-main), var(--color-accent))";
        background.style.background = initialGradient;

        function handleExploreClick() {
            if (isTransitioning) return;
            isTransitioning = true;

            heroView.classList.add('hidden');
            attractionsView.classList.add('visible');

            // Listen for the transition to end on the attractions view
            attractionsView.addEventListener('transitionend', () => {
                isTransitioning = false;
            }, { once: true });
        }

        function handleAttractionClick(event) {
            if (isTransitioning) return;
            isTransitioning = true;

            // Use currentTarget to ensure we get the button, even if an inner element is clicked
            const card = event.currentTarget; 
            const id = card.dataset.id;
            const data = attractionsData[id];

            // Populate detail view
            detailTitle.textContent = data.title;
            detailDescription.textContent = data.description;
            background.style.background = data.gradient;
            
            appContainer.classList.add('detail-view-active');
            attractionsView.classList.remove('visible');

            // Wait for the attractions grid to fade out before showing the detail view
            const transitionPromise = new Promise(resolve => {
                attractionsView.addEventListener('transitionend', function onTransitionEnd(e) {
                    if (e.propertyName === 'opacity') {
                        attractionsView.removeEventListener('transitionend', onTransitionEnd);
                        resolve();
                    }
                });
            });

            transitionPromise.then(() => {
                detailView.classList.add('visible');
                // Focus the close button for accessibility
                closeButton.focus();
                isTransitioning = false;
            });
        }

        function handleCloseClick() {
            if (isTransitioning) return;
            isTransitioning = true;

            appContainer.classList.remove('detail-view-active');
            detailView.classList.remove('visible');

            // Listen for the detail view to fully transition out
            detailView.addEventListener('transitionend', (e) => {
                if (e.propertyName === 'opacity') {
                    background.style.background = initialGradient;
                    attractionsView.classList.add('visible');

                    // Focus the first attraction card when returning
                    if(attractionCards.length > 0) {
                        attractionCards[0].focus();
                    }

                    // Reset the transitioning flag only after the final animation
                    attractionsView.addEventListener('transitionend', (e) => {
                         if (e.propertyName === 'opacity') {
                            isTransitioning = false;
                         }
                    }, { once: true });
                }
            }, { once: true });
        }
        
        // --- Initialization ---
        function initializeAttractions() {
            const fragment = document.createDocumentFragment();
            for (const id in attractionsData) {
                const attraction = attractionsData[id];
                const card = document.createElement('button');
                card.className = 'attraction-card';
                card.dataset.id = id;
                card.innerHTML = `
                    <div class="shape"></div>
                    <h2>${attraction.title}</h2>
                `;
                // Add clip-path from data
                card.querySelector('.shape').style.clipPath = attraction.clipPath;
                card.addEventListener('click', handleAttractionClick);
                fragment.appendChild(card);
            }
            attractionsView.appendChild(fragment);
        }

        // Event Listeners
        exploreButton.addEventListener('click', handleExploreClick);
        closeButton.addEventListener('click', handleCloseClick);

        // Initial setup
        initializeAttractions();

    </script>
</body>
</html>
